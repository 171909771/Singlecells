```r
library(Seurat)
library(harmony)
## 合并数据
sc28 <- readRDS("28.RDS")
sc28 = UpdateSeuratObject(object = sc28)
sc29 <- readRDS("29.RDS")
sc29 = UpdateSeuratObject(object = sc29)
sc30 <- readRDS("30.RDS")
sc30 = UpdateSeuratObject(object = sc30)
sc28$type <- "28"
sc29$type <- "29"
sc30$type <- "30"
single_obj <- merge(sc28, y = c(sc29, sc30), add.cell.ids = c("28", "29", "30"), project = "single_obj")
# 该数据已经QC-filtered

## normalization_scale_harmony_findclusters
### return.only.var.genes=F: 返回所有scale
single_obj <- SCTransform(single_obj, return.only.var.genes=F ,method = "glmGamPoi", vars.to.regress = "percent.mt", verbose = FALSE) %>% 
  RunPCA(verbose = FALSE)
single_obj <- RunHarmony(single_obj, group.by.vars = "type")
single_obj <- RunUMAP(single_obj, reduction = "harmony", dims = 1:30)
single_obj <- FindNeighbors(single_obj, reduction = "harmony", dims = 1:30) %>% FindClusters()
DimPlot(single_obj, group.by = "type",reduction ="umap")
saveRDS(single_obj,"32.RDS")
```
