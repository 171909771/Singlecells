dat1 <-  readRDS('geneset1.rds')


tmp1 <- dat1[["MCAO"]][["Monocytes/Macrophages"]]
tmp2 <- dat1[["Sham"]][["Monocytes/Macrophages"]]
tmp1 <- subset(tmp1,value >= 0.6)
tmp2 <- subset(tmp2,value >= 0.6)

set1 <- tmp1$genenames
set2 <- tmp2$genenames



############################## plot venn
library(ggvenn)

# Prepare the data as logical vectors or columns
venn_data <- list( MCAO = set1,  Sham = set2)
myplot <- ggvenn(venn_data,set_name_size = 4)+ labs(title="Monocytes/Macrophages")+
  theme(plot.title = element_text(hjust = 0.5, vjust = -20))

ggsave("my_plot.png", plot = myplot, width = 5, height = 5, dpi = 300)

interdat <- intersect(set1,set2)


#################################GO ANALYSIS

library(GOplot)
library(ggplot2)
library(ggsci)
library(clusterProfiler)

# Set databases for GO and KEGG analysis
GO_database <- 'org.Mm.eg.db'
KEGG_database <- 'mmu'

# Convert gene symbols to ENTREZ IDs
gene <- bitr(interdat, fromType = 'SYMBOL', toType = 'ENTREZID', OrgDb = GO_database)

# Perform GO enrichment analysis
GO <- enrichGO(gene$ENTREZID,
               OrgDb = GO_database,
               keyType = "ENTREZID",
               ont = "BP",
               pvalueCutoff = 0.05,
               qvalueCutoff = 0.05,
               readable = TRUE)

# Extract results from the GO analysis
goresult <- GO@result

# Filter results for "signaling" related terms
goresult <- goresult[grep("signaling", goresult$Description),]

# Calculate GeneRatio
goresult$GeneRatio <- goresult$Count / sum(goresult$Count)

# Subset for significant results
goresult <- subset(goresult, pvalue < 0.05)

# Order and limit to the top 10 significant terms
goresult <- goresult[order(goresult$GeneRatio, decreasing = TRUE),][1:10,]
goresult$Description <- factor(goresult$Description, levels = rev(goresult$Description))

# Create a plot
myplot <- ggplot(goresult, aes(x = GeneRatio, y = Description, size = Count, color = pvalue)) +
  geom_point() +
  theme_classic() +
  scale_color_gradient(low = "blue", high = "red") +
  theme(axis.title.y = element_blank())

ggsave("Macrophages.png", plot = myplot, width = 10, height = 5, dpi = 300, scale = 0.8)

