SCTransform后，并得到分群信息后
---

### 计算均值
```
gene.mean=apply(annotation1@assays[["SCT"]]@data,1,mean)
gene.mean=sort(gene.mean)
bin_ind <- ceiling(x = 1:length(x = gene.mean) / 762)
dat1=data.frame('name'=names(gene.mean),'value'=gene.mean,'cluster'=bin_ind)
kk=0
for (i in c(1:25)){
  kk=kk+mean(sample(dat1[dat1$cluster==i,]$value,size=100))
  
}
totalmean=kk/25
```

### 回归分析
```
##### 获得目的分群的dataframe
microglia.nor=subset(annotation1,group=="IS")
microglia.nor=subset(microglia.nor,idents="Astrocytes")
dat.microglia.nor=data.frame(microglia.nor@assays[["SCT"]]@data)
##### 画图看分布
plot(density(as.numeric(dat.microglia.nor['Ripk1',]))  )
##### tweedie分布回归
library(MASS)
library(statmod)
library(pscl)
##### 计算斜率和P值
y1=as.numeric(dat.microglia.nor['Ripk1',])
result.tweedie=apply(dat.microglia.nor,1,function(x){
  y=glm(y1~x,family=tweedie(var.power=1.1,link.power=0))
  y1=summary(y)
  return(c(y1$coefficients[2],y1$coefficients[8]))
  
  })
result.tweedie=data.frame(t(result.tweedie))
colnames(result.tweedie)=c('slope','P-value')
##### 算adj-p
result.tweedie$adjP=p.adjust(result.tweedie$`P-value`,method = 'BH')
```

### 取cluser的值，并计算中心化的数值
```
##### 排序，取top100的基因
result.tweedie=result.tweedie[order(result.tweedie$adjP,decreasing = F),]
result.tweedie.100=head(result.tweedie,100)
value1=dat1[rownames(result.tweedie.100),]$value
##### 用上面的均值进行scale
meanerror=value1-totalmean
sqrtmean=junfang=sqrt(sum(meanerror^2)/(length(meanerror)))
scalevalue=meanerror/sqrtmean    # scale后的数值
clusterfinal=mean(scalevalue)     # scale后的数值的平均值
```
