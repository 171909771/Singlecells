### 提取microglia细胞
```r
library(monocle)
library(Seurat)
library(SeuratWrappers)
library(ggplot2)
library(patchwork)
library(magrittr)

dat1 <- readRDS('prunnedfinalcluster.rds')
dat1 <- subset(dat1,tmp=='Microglia')
dat1 <- subset(dat1,celltype.group=='MCAO')
```

### 载入monocle矩阵
```r
DefaultAssay(object = dat1 ) <- "RNA"
expr_matrix <- as.matrix(dat1@assays[["RNA"]]@counts)
pd <- dat1@meta.data
fd <- data.frame(gene_short_name= rownames(expr_matrix) , row.names = rownames(expr_matrix))
pd <- new("AnnotatedDataFrame", data = pd)
fd <- new("AnnotatedDataFrame", data = fd)
cds <- newCellDataSet(cellData=expr_matrix, phenoData  = pd, featureData  = fd,
                      lowerDetectionLimit = 0.1)
```

### 数据前处理
```r
cds <- estimateSizeFactors(cds)  
cds <- estimateDispersions(cds)
disp_table <- dispersionTable(cds) 
disp.genes <- subset(disp_table, mean_expression >= 0.1)
cds <- setOrderingFilter(cds, disp.genes$gene_id)
plot_pc_variance_explained(cds, return_all = F) # norm_method='log'
### 通过拐点确定n值
### max_components 的个数决定state个数
n= 8
cds <- reduceDimension(cds, num_dim = 8，max_components = 2,reduction_method  = 'DDRTree') 
cds <- orderCells(cds)
```


