
先得到seurat数据
----
```
library(Seurat)
library(patchwork)
# 根据分组信息进行车分数据
sce.list <- SplitObject(sce, split.by = "group")
# 对不同list进行标准化
sce.list <- lapply(X = sce.list, FUN = function(x) {
    x <- NormalizeData(x, verbose = FALSE)
    x <- FindVariableFeatures(x, verbose = FALSE)
  })
```
开始整合数据
---
    方法1: `rPCA`
    # 速度更快，需要先对数据进行上面的PCA。切满足下面3个使用条件：
    * A substantial fraction of cells in one dataset have no matching type in the other 
    * Datasets originate from the same platform (i.e. multiple lanes of 10x genomics) 
    * There are a large number of datasets or cells to integrate 
```
# 找关键基因
features <- SelectIntegrationFeatures(object.list = sce.list)
# 归一化，并作PCA
sce.list <- lapply(X = sce.list, FUN = function(x) {
    x <- ScaleData(x, features = features, verbose = FALSE)
    x <- RunPCA(x, features = features, verbose = FALSE)
  })
# 找锚点
anchors <- FindIntegrationAnchors(object.list = sce.list, anchor.features = features, reduction = "rpca",
                                    dims = 1:50)  
# 设置锚点，整合完成                                    
sce.integrated <- IntegrateData(anchorset = anchors, dims = 1:50)
```
分群
---
```
sce.integrated <- ScaleData(sce.integrated, verbose = FALSE)
sce.integrated <- RunPCA(sce.integrated, verbose = FALSE)
sce.integrated <- RunUMAP(sce.integrated, dims = 1:50)

immune.combined <- FindNeighbors(sce.integrated, reduction = "pca", dims = 1:30)
immune.combined <- FindClusters(immune.combined, resolution = 0.5)

p1 <- DimPlot(immune.combined, reduction = "umap", group.by = "group")
p2 <- DimPlot(immune.combined, reduction = "umap", label = TRUE, repel = TRUE)
p1 + p2
```









